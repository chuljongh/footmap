# 발길맵 (Balgil Map) 기능 명세서

본 문서는 프로젝트의 상세 기능 요구사항 및 명세서입니다.

## 1. 개요
- **목표**: 배달원과 휠체어 이용자를 위한 **집단지성 기반 라스트 마일 경로 공유** 및 소셜 매핑 플랫폼
- **핵심 가치**: **실제 이동 궤적(Trace) 공유**, **매장 및 건물 출입구 식별**, 보행 약자 이동 경로 시각화

## 2. 아키텍처
### 프론트엔드
- **기술 스택**: Vanilla JS (ES6+), HTML5, CSS3, OpenLayers v8.2
- **지도 엔진**:
  - **Base**: 국토교통부 V-World (브이월드) 타일
  - **Overlay**: Kakao Maps SDK (로컬 정보, 주소 검색용 - API 프록시 연동)
- **상태 관리**: `AppState` (전역 객체) + `localStorage` + `IndexedDB`

### 백엔드
- **기술 스택**: Python Flask
- **데이터베이스**: SQLAlchemy ORM (PostgreSQL)

## 3. 핵심 기능 상세

### 3.1 지도 및 경로 공유 (Traces)
- **앱 진입 및 모드 설정**:
  - 앱 설치/최초 진입 시 **도보(Default)** vs **휠체어** 모드 선택
  - 설정(햄버거 메뉴)에서 언제든지 모드 변경 가능
- **이동 모드 특성 (집단지성 궤적)**:
  - **도보(Walking)**: 일반 보행자들이 실제로 다닌 경로와 출입구 데이터 표시
  - **휠체어(Wheelchair)**: '휠체어 모드'로 이동한 사용자들의 실제 이동 경로(Trace)를 공유하여 보여줌
- **이동 궤적 시각화 (Trajectory)**:
  - 사용자들의 누적된 이동 경로를 지도에 오버레이
  - **목적**: 지도에 나오지 않는 **실질적인 매장/건물 출입구 위치**와 **지름길** 식별
  - 데이터가 쌓일수록 선명해지는 히트맵 방식 (많이 다닌 길 = 입구/주요 통로)
- **목적지 설정**:
  - 지도 더블 클릭 (PC) / 투 핑거 탭 (모바일)
  - 주소 검색 (Kakao Local API)

### 3.2 UI/UX 및 플로팅 모드
- **플로팅 오버레이 (Floating Mode)**:
  - 다른 배달 앱(배민, 쿠팡이츠 등) 위에 떠 있는 미니맵
  - **크기**: 800x600px 또는 스마트폰 세로 높이의 1/3 중 작은 값으로 자동 설정 (설정에서 조정 가능)
  - 드래그 앤 드롭으로 위치 이동 가능
- **Zero-Touch Navigation (클립보드 연동)**:
  - 플로팅 모드 활성화 상태에서 동작
  - 타 앱에서 '주소 복사' 시 발길맵이 클립보드를 자동 인식
  - **자동 실행 시퀀스**: [기존 경로 삭제] ➔ [복사된 주소 검색] ➔ [경로 안내 자동 시작]
  - *목적*: 배달원이 주소 복사 후 단 1회의 터치 없이도 안내를 받도록 함

### 3.3 대시보드 및 정보 표시
- **주행 중 정보 (HUD)**:
  - 턴 바이 턴 안내, 남은 거리/시간 표시
- **주소 표시**:
  - '목적지 주변' 메시지와 현재 주소를 3초 주기로 토글
  - 목적지 주변 메시지: 상세 주소가 일치하는 글 우선, 없으면 상세 주소만 다른 인근 인기 글 표시
- **플로팅 모드 메시지**:
  - 화면 하단에 가독성 좋게 한 줄로 메시지 나열

### 3.4 경유지 및 라우팅 옵션
- **위치 지정 시 메뉴**:
  - 🏁 **새 목적지로 설정**: 기존 경로 초기화 후 새 경로 안내
  - ➕ **경유지로 추가**: 현재 경로에 경유지 추가
  - 🏁➡️ **최종 목적지로 추가**: 현재 목적지를 경유지로 변경하고, 선택 위치를 최종 목적지로 설정
  - ❌ **취소**

### 3.5 소셜 커뮤니티 (Social)
- **상호작용 버튼**:
  - **내 글**: [좋아요] [싫어요] [공유하기] [재작성(수정)] [삭제]
  - **타인 글**: [좋아요] [싫어요] [공유하기] [댓글달기] [저장하기]
- **프로필 정책**:
  - 초기: 익명/랜덤 닉네임 사용 가능
  - 글 작성 3회 이상(2~3개 초과) 시: 데이터 보존을 위해 구글 ID 로그인 권고

## 4. 데이터 관리
- **로컬 저장소**: `localStorage` (설정), `IndexedDB` (주행 로그)
- **서버 동기화**: 주행 종료 후 또는 와이파이 연결 시 로그 업로드 (코드 구현 필요)

## 5. API 명세 (`server.py`)
(기존 분석 내용 유지)
- GET `/api/messages`: 범위 내 메시지 조회
- POST `/api/messages`: 메시지 작성
- PUT/DELETE `/api/messages/<id>`: 수정/삭제
- POST `/api/messages/<id>/vote`: 투표
- GET `/api/search`: 장소 검색
- GET `/api/reverse-geo`: 주소 변환
