<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>발길맵 - 라스트 마일 내비게이션</title>
    <meta name="description" content="배달원과 휠체어 이용자를 위한 초정밀 라스트 마일 내비게이션">

    <title>발길맵 (Footprint Map)</title>
    <!-- OpenLayers CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css">

    <!-- Kakao Maps SDK (로컬 API 사용, autoload=false) -->
    <script type="text/javascript"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=94efadb747ddb4a6f534eae8dc61a99e&libraries=services&autoload=false"></script>

    <!-- Main CSS -->
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- 스플래시 화면 -->
    <div id="splash-screen" class="screen active">
        <div class="splash-content">
            <div class="logo-container">
                <div class="footprint-icon">👣</div>
                <h1 class="app-title">발길맵</h1>
                <p class="app-subtitle">라스트 마일 내비게이션</p>
            </div>
            <div class="loading-indicator">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
            </div>
        </div>
    </div>

    <!-- 온보딩 - 권한 안내 -->
    <div id="permission-screen" class="screen">
        <div class="onboarding-content">
            <h2>앱 사용을 위해<br>다음 권한이 필요합니다</h2>

            <div class="permission-cards">
                <div class="permission-card">
                    <div class="permission-icon">📍</div>
                    <div class="permission-info">
                        <h3>위치 정보</h3>
                        <p>현재 위치와 이동 경로를 표시합니다</p>
                    </div>
                </div>
                <div class="permission-card">
                    <div class="permission-icon">🗺️</div>
                    <div class="permission-info">
                        <h3>오버레이</h3>
                        <p>다른 앱 위에 지도를 표시합니다</p>
                    </div>
                </div>
                <div class="permission-card">
                    <div class="permission-icon">📋</div>
                    <div class="permission-info">
                        <h3>클립보드</h3>
                        <p>복사한 주소로 바로 안내합니다</p>
                    </div>
                </div>
            </div>

            <button id="permission-next-btn" class="primary-btn">다음</button>
        </div>
    </div>

    <!-- 온보딩 - 모드 선택 -->
    <div id="mode-screen" class="screen">
        <div class="onboarding-content">
            <h2>이동 수단을 선택해주세요</h2>
            <p class="mode-description">선택한 모드에 맞는 경로를 안내해 드립니다</p>

            <div class="mode-options">
                <button class="mode-option selected" data-mode="walking">
                    <div class="mode-icon">🚶</div>
                    <div class="mode-label">도보</div>
                    <div class="mode-check">✓</div>
                </button>
                <button class="mode-option" data-mode="wheelchair">
                    <div class="mode-icon">♿</div>
                    <div class="mode-label">휠체어</div>
                    <div class="mode-check">✓</div>
                </button>
            </div>

            <p class="mode-note">* 설정에서 언제든지 변경할 수 있습니다</p>

            <button id="mode-next-btn" class="primary-btn">시작하기</button>
        </div>
    </div>

    <!-- 메인 지도 화면 -->
    <div id="main-screen" class="screen">
        <!-- 상단 바 -->
        <header class="top-bar glass">
            <button id="menu-btn" class="icon-btn" aria-label="메뉴">
                <span class="hamburger-icon">≡</span>
            </button>
            <div class="search-container">
                <div class="search-input-wrapper">
                    <input type="text" id="search-input" placeholder="주소를 입력하세요" autocomplete="off">
                    <button id="search-clear-btn" class="icon-btn clear hidden" aria-label="지우기">✕</button>
                    <ul id="search-suggestions" class="suggestion-list"></ul>
                </div>
                <button id="search-btn" class="icon-btn search-action" aria-label="검색">🔍</button>
            </div>
        </header>

        <!-- Navigation HUD (투명 배경, 굵은 글씨) -->
        <!-- Navigation HUD (투명 배경, 굵은 글씨) -->
        <div id="navigation-hud" class="navigation-hud hidden">
            <!-- Left: 전체 정보 (작게) -->
            <div class="hud-group stats">
                <div class="hud-value" id="nav-total-time">0분</div>
                <div class="hud-label" id="nav-total-dist">0km</div>
            </div>

            <!-- Center: 핵심 턴 정보 (아주 크게) -->
            <div class="hud-group primary">
                <div class="hud-icon large" id="nav-next-turn-icon">⬆️</div>
                <div class="hud-value large" id="nav-next-dist">0m</div>
            </div>

            <!-- Right: 다음 턴 (작게, 포맷 통일) -->
            <div class="hud-group secondary">
                <div class="hud-icon small" id="nav-second-icon">⬆️</div>
                <div class="hud-value small" id="nav-second-dist">0m</div>
            </div>
        </div>

        <!-- 지도 영역 -->
        <div id="map-container">
            <div id="map"></div>

            <!-- 집단지성 궤적 범례 -->
            <div class="trajectory-legend glass">
                <div class="legend-item">
                    <span class="legend-line red"></span>
                    <span>1-3명</span>
                </div>
                <div class="legend-item">
                    <span class="legend-line orange"></span>
                    <span>4-10명</span>
                </div>
                <div class="legend-item">
                    <span class="legend-line green"></span>
                    <span>10명+</span>
                </div>
            </div>
        </div>

        <!-- 하단 경로 안내 버튼 -->
        <div class="bottom-bar glass">
            <button id="navigate-btn" class="navigate-btn disabled">
                <span id="mode-indicator" class="mode-indicator">🚶</span>
                <span class="btn-text">경로 안내 시작</span>
            </button>

            <!-- Context Dashboard (안내 중 표시) -->
            <div id="dashboard-container" class="dashboard-container hidden">
                <div class="dashboard-info">
                    <div id="dash-primary" class="dash-text primary">정보 로딩중...</div>
                    <div id="dash-secondary" class="dash-text secondary">잠시만 기다려주세요</div>
                </div>
                <div class="dashboard-actions">
                    <button id="report-btn" class="icon-btn small warning" aria-label="신고">🚨</button>
                    <button id="stop-nav-btn" class="icon-btn small stop" aria-label="안내 종료">⏹️</button>
                </div>
            </div>
        </div>

        <!-- 사이드 메뉴 -->
        <div id="side-menu" class="side-menu">
            <div class="menu-header profile-mode">
                <div class="profile-container">
                    <div class="profile-img-wrapper">
                        <img id="profile-img"
                            src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ddd'/%3E%3Ctext x='50' y='50' dy='.3em' text-anchor='middle' font-size='40'%3E👤%3C/text%3E%3C/svg%3E"
                            alt="Profile">
                        <button id="edit-profile-img-btn" class="edit-btn" aria-label="사진 변경">📷</button>
                        <input type="file" id="profile-img-input" accept="image/*" class="hidden">
                    </div>
                    <div class="profile-info-wrapper">
                        <div class="nickname-row">
                            <input type="text" id="profile-nickname" value="" readonly>
                            <button id="edit-nickname-btn" class="edit-btn" aria-label="별명 수정">✏️</button>
                        </div>
                    </div>
                </div>
                <button id="close-menu-btn" class="icon-btn close-menu">✕</button>
            </div>
            <nav class="menu-nav">
                <!-- 나의 기록 (최상단, 강조) -->
                <button class="menu-item highlight" data-action="my-records">
                    <span>🏆</span> 나의 기록
                </button>

                <button class="menu-item" data-action="mode-change">
                    <span id="current-mode-icon">🚶</span> 모드 변경
                </button>
                <button class="menu-item" data-action="overlay-settings">
                    <span>🗺️</span> 오버레이 설정
                </button>
                <!-- 기존 설정 메뉴 삭제됨 -->
            </nav>
            <div class="menu-footer">
                <p>발길맵 v1.0.0</p>
                <p>Balgil Map</p>
            </div>
        </div>
        <div id="menu-overlay" class="menu-overlay"></div>
    </div>

    <!-- 플로팅 오버레이 모드 (데모용) -->
    <div id="floating-overlay" class="floating-overlay hidden">
        <div class="overlay-header">
            <span class="destination-text">📍 → <span id="overlay-destination">목적지명</span></span>
            <button id="close-overlay-btn" class="icon-btn small">✕</button>
        </div>
        <div id="overlay-map" class="overlay-map"></div>
        <div class="resize-handle"></div>
    </div>

    <!-- 오버레이 설정 모달 -->
    <div id="overlay-settings-modal" class="modal hidden">
        <div class="modal-content glass">
            <h3>오버레이 설정</h3>
            <div class="setting-item">
                <label for="opacity-slider">투명도: <span id="opacity-value">30</span>%</label>
                <input type="range" id="opacity-slider" min="0" max="50" value="30">
            </div>
            <div class="modal-actions">
                <button id="close-settings-btn" class="secondary-btn">닫기</button>
            </div>
        </div>
    </div>

    <!-- 경유지 설정 모달 -->
    <div id="waypoint-modal" class="modal hidden">
        <div class="modal-content glass">
            <h3>위치 옵션</h3>
            <div class="waypoint-options">
                <button class="waypoint-btn" data-action="new-dest">
                    <span class="waypoint-icon">🏁</span>
                    <span>새 목적지로 설정</span>
                </button>
                <button class="waypoint-btn" data-action="waypoint">
                    <span class="waypoint-icon">➕</span>
                    <span>경유지로 추가</span>
                </button>
                <button class="waypoint-btn" data-action="final-dest">
                    <span class="waypoint-icon">🏁➡️</span>
                    <span>최종 목적지로 추가</span>
                </button>
                <button class="waypoint-btn cancel" data-action="cancel">
                    <span>취소</span>
                </button>
            </div>
        </div>
    </div>

    <!-- OpenLayers JS -->
    <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>

    <!-- App JS -->
    <script src="app.js"></script>
</body>

</html>