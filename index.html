<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="color-scheme" content="only light">
    <title>ë°œê¸¸ë§µ - ë¬´ì¥ì•  ê¸¸ì•ˆë‚´</title>
    <style>
        /* [CRITICAL] Static First Rendering Styles */
        /* JS ë¡œë“œ ì „ì—ë„ í™”ë©´ì„ ì¦‰ì‹œ í‘œì‹œí•˜ê¸° ìœ„í•œ í•„ìˆ˜ ìŠ¤íƒ€ì¼ */
        body { margin: 0; background-color: #0A1628; } /* Theme Blue */
        .screen { display: none; }
        .screen.active { display: flex; }

        /* returning user hidden */
        html.onboarding-complete #intro-layer { display: none !important; }

        /* Intro Layer Styles (Moved from body) */
        #intro-layer {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background-color: #1a1a1a; /* Dark Theme Default */
            color: white;
            display: flex; /* Default Visible */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            transition: opacity 0.3s ease;
        }

        .intro-container {
            width: 100%;
            max-width: 360px;
            padding: 24px;
            box-sizing: border-box;
            text-align: center;
        }
        .intro-step {
            display: none;
            /* animation: fadeIn 0.4s ease; REMOVED for Zero-Latency */
        }
        .intro-step.active { display: block; animation: none; }

        .intro-logo { font-size: 48px; margin-bottom: 16px; }
        .intro-title { font-size: 24px; font-weight: 700; margin-bottom: 8px; color: #fff; }
        .intro-desc { font-size: 14px; color: #a0aec0; margin-bottom: 32px; line-height: 1.5; }

        .perm-list { text-align: left; margin-bottom: 32px; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; }
        .perm-item { display: flex; align-items: center; margin-bottom: 16px; }
        .perm-item:last-child { margin-bottom: 0; }
        .perm-icon { font-size: 20px; margin-right: 12px; width: 24px; text-align: center; }
        .perm-text { font-size: 14px; color: #e2e8f0; }

        .mode-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 32px; }
        .mode-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 20px 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .mode-card.selected {
            background: rgba(0, 212, 170, 0.1);
            border-color: #00d4aa;
        }
        .mode-icon { font-size: 70px; margin-bottom: 8px; display: block; }
        .mode-name { font-size: 16px; font-weight: 600; color: #cccccc !important; }

        .btn-large {
            width: 100%;
            padding: 16px;
            background: #00d4aa;
            color: #000;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }
        .btn-large:active { transform: scale(0.98); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
    <script>
        // [Zero-Latency] ì•± ì‹¤í–‰ ì¦‰ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í™•ì¸ í›„ ì´ˆê¸° í™”ë©´ ê²°ì •
        // app.js ë¡œë”©ì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ë ˆì´ì•„ì›ƒì„ ì¡ì•„ í° í™”ë©´ ì œê±°
        (function() {
            try {
                var isComplete = localStorage.getItem('balgil_onboardingComplete');
                if (isComplete && JSON.parse(isComplete) === true) {
                    document.documentElement.className = 'onboarding-complete';
                    // [FIX] CSSê°€ ì ìš©ë˜ì§€ ì•ŠëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ì§ì ‘ ìˆ¨ê¹€
                    var introLayer = document.getElementById('intro-layer');
                    if (introLayer) introLayer.style.display = 'none';
                } else {
                    document.documentElement.className = 'new-user';
                }
            } catch (e) {
                document.documentElement.className = 'new-user';
            }
        })();
    </script>
    <meta name="description" content="ë°°ë‹¬ì›ê³¼ íœ ì²´ì–´ ì´ìš©ìë¥¼ ìœ„í•œ ì´ˆì •ë°€ ë¼ìŠ¤íŠ¸ ë§ˆì¼ ë‚´ë¹„ê²Œì´ì…˜">

    <!-- Fonts (System Default) -->
    <!-- <link href="https://fonts.googleapis.com/css2..." rel="stylesheet"> -->

    <!-- Main Styles (Local & Non-Blocking) -->
    <link rel="preload" href="styles.css?v=20260122_3" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="styles.css?v=20260122_3"></noscript>

    <link rel="preload" href="css/dashboard.css?v=20260122_3" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="css/dashboard.css?v=20260122_3"></noscript>

    <!-- OpenLayers CSS (Non-Blocking) -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css"></noscript>

    <!-- Kakao Maps SDK (Deferred) -->
    <!-- <script type="text/javascript" src="https://dapi.kakao.com/..."></script> -->

</head>

<body>


    <!-- [CRITICAL] Visible-by-Default Intro Layer -->
    <!-- ê¸°ë³¸ì ìœ¼ë¡œ ë³´ì„ ìƒíƒœ. JSê°€ ì—†ì–´ë„ ë Œë”ë§ë¨. -->
    <div id="intro-layer">
        <div class="intro-container">
            <!-- Step 1: Permissions (3ê°€ì§€ ê¶Œí•œ ì•ˆë‚´) -->
            <div id="intro-step-1" class="intro-step active">
                <img src="icon.png" alt="ë°œê¸¸ë§µ" style="width: 80px; height: 80px; margin-bottom: 20px; border-radius: 20px;">
                <h1 class="intro-title">ë°œê¸¸ë§µ ì‹œì‘í•˜ê¸°</h1>
                <p class="intro-desc">ëˆ„êµ¬ë‚˜ ì‰½ê³  í¸í•˜ê²Œ ì´ë™í•  ìˆ˜ ìˆë„ë¡<br>ë‹¤ìŒ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.</p>

                <div class="permission-cards" style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px;">
                    <div class="permission-card" style="display: flex; align-items: center; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.12); border-radius: 16px; padding: 16px 20px;">
                        <div class="permission-icon" style="width: 48px; height: 48px; background: rgba(0,212,170,0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-right: 16px; flex-shrink: 0;">ğŸ“</div>
                        <div class="permission-info" style="flex: 1;">
                            <h3 style="font-size: 16px; font-weight: 700; color: #fff; margin: 0 0 4px 0;">ìœ„ì¹˜ ì •ë³´</h3>
                            <p style="font-size: 13px; color: #94a3b8; line-height: 1.4; margin: 0;">í˜„ì¬ ìœ„ì¹˜ì™€ ì´ë™ ê²½ë¡œë¥¼ í‘œì‹œí•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                    <div class="permission-card" style="display: flex; align-items: center; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.12); border-radius: 16px; padding: 16px 20px;">
                        <div class="permission-icon" style="width: 48px; height: 48px; background: rgba(0,212,170,0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-right: 16px; flex-shrink: 0;">ğŸ—ºï¸</div>
                        <div class="permission-info" style="flex: 1;">
                            <h3 style="font-size: 16px; font-weight: 700; color: #fff; margin: 0 0 4px 0;">ì˜¤ë²„ë ˆì´</h3>
                            <p style="font-size: 13px; color: #94a3b8; line-height: 1.4; margin: 0;">ë‹¤ë¥¸ ì•± ìœ„ì— ì§€ë„ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                    <div class="permission-card" style="display: flex; align-items: center; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.12); border-radius: 16px; padding: 16px 20px;">
                        <div class="permission-icon" style="width: 48px; height: 48px; background: rgba(0,212,170,0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-right: 16px; flex-shrink: 0;">ğŸ“‹</div>
                        <div class="permission-info" style="flex: 1;">
                            <h3 style="font-size: 16px; font-weight: 700; color: #fff; margin: 0 0 4px 0;">í´ë¦½ë³´ë“œ</h3>
                            <p style="font-size: 13px; color: #94a3b8; line-height: 1.4; margin: 0;">ë³µì‚¬í•œ ì£¼ì†Œë¡œ ë°”ë¡œ ì•ˆë‚´í•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>

                <button class="btn-large" onclick="nextStep()">ë‹¤ìŒ</button>
            </div>

            <!-- Step 2: Mode Selection -->
            <div id="intro-step-2" class="intro-step">
                <h1 class="intro-title">ì–´ë–»ê²Œ ì´ë™í•˜ì‹œë‚˜ìš”?</h1>
                <p class="intro-desc">ì„ íƒí•˜ì‹  ìˆ˜ë‹¨ì— ë§ì¶°<br>ìµœì ì˜ ê²½ë¡œë¥¼ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.</p>

                <div class="mode-grid">
                    <div class="mode-card selected" onclick="selectMode('walking', this)">
                        <span class="mode-icon" style="display: inline-block; transform: scaleX(-1);">ğŸš¶</span>
                        <span class="mode-name">ë„ë³´</span>
                    </div>
                    <div class="mode-card" onclick="selectMode('wheelchair', this)">
                        <span class="mode-icon">ğŸ§‘â€ğŸ¦½</span>
                        <span class="mode-name">íœ ì²´ì–´</span>
                    </div>
                </div>

                <button class="btn-large" onclick="finishIntro()">ì‹œì‘í•˜ê¸°</button>
            </div>
        </div>

        <script>
            // Inline Interactions (No heavy JS dependency)
            let selectedMode = 'walking';

            function nextStep() {
                // [Unified Flow] ì›¹ì—ì„œ [ë‹¤ìŒ] í´ë¦­ ì‹œ ë„¤ì´í‹°ë¸Œ ê¶Œí•œ ìš”ì²­ íŠ¸ë¦¬ê±°
                // Android ì¸í„°í˜ì´ìŠ¤ê°€ ìˆìœ¼ë©´ í˜¸ì¶œ, ì—†ìœ¼ë©´(ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸) ë°”ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ
                if (window.Android && window.Android.requestPermissions) {
                    window.Android.requestPermissions();
                } else {
                    // PC ë¸Œë¼ìš°ì € ë“± ë””ë²„ê¹…ìš© Fallback
                    onNativePermissionGranted();
                }
            }

            // [Unified Flow] ë„¤ì´í‹°ë¸Œì—ì„œ ê¶Œí•œ íšë“ ì™„ë£Œ ì‹œ í˜¸ì¶œë¨
            window.onNativePermissionGranted = function() {
                document.getElementById('intro-step-1').classList.remove('active');
                document.getElementById('intro-step-2').classList.add('active');
            };

            function selectMode(mode, el) {
                selectedMode = mode;
                document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('selected'));
                el.classList.add('selected');
            }

            function finishIntro() {
                // Save to localStorage immediately
                localStorage.setItem('balgil_onboardingComplete', 'true');
                localStorage.setItem('balgil_userMode', JSON.stringify(selectedMode));

                // Hide Intro
                document.getElementById('intro-layer').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('intro-layer').style.display = 'none';
                    // Trigger Main App Init if loaded
                    if (window.UIManager) {
                        window.UIManager.updateModeIndicator();
                        if (window.AppState && !window.AppState.map) {
                             window.MapManager?.init();
                        } else {
                             // [Fix] ì´ˆê¸°í™”ëŠ” ë˜ì—ˆìœ¼ë‚˜ ê¶Œí•œ ë¬¸ì œë¡œ City Hallì— ìˆë˜ ë§µì„ í˜„ìœ„ì¹˜ë¡œ ì´ë™
                             window.MapManager?.getCurrentPosition();
                             // [Critical Fix] í™”ë©´ì´ ë³´ì´ê¸° ì‹œì‘í–ˆì„ ë•Œ ì‚¬ì´ì¦ˆ ê°±ì‹  (Blue Screen ë°©ì§€)
                             if (window.AppState && window.AppState.map) {
                                 window.AppState.map.updateSize();
                             }
                        }
                    }
                }, 300);
            }
        </script>
    </div>

    <!-- Main App Screen (Initially Hidden by Intro Layer) -->
    <div id="main-screen" class="screen active">
        <!-- ìƒë‹¨ ë°” + ê²€ìƒ‰ ë²„íŠ¼ ë˜í¼ -->
        <div class="top-bar-wrapper">
            <header class="top-bar glass">
                <button id="menu-btn" class="icon-btn" aria-label="ë©”ë‰´">
                    <span class="hamburger-icon">â‰¡</span>
                </button>
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <input type="text" id="search-input" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
                        <button id="search-clear-btn" class="icon-btn" aria-label="ì§€ìš°ê¸°">âœ•</button>
                        <ul id="search-suggestions" class="suggestion-list"></ul>
                    </div>
                </div>
            </header>
            <!-- ê²€ìƒ‰ ë²„íŠ¼ì„ top-bar ë°”ê¹¥ì— ë°°ì¹˜ -->
            <button id="search-btn" class="icon-btn search-action" aria-label="ê²€ìƒ‰">ğŸ”</button>


        </div>

        <!-- ì§€ë„ ì˜ì—­ -->
        <div id="map-container">
            <div id="map"></div>
        </div>

        <!-- í•˜ë‹¨ ì•¡ì…˜ ë°” (ëŒ€í™”/ê¸€ì“°ê¸°/ì•ˆë‚´) -->
        <div class="bottom-bar glass">
            <div id="pre-nav-actions" class="bottom-actions-row">
                <button id="chat-btn" class="icon-btn action-btn" aria-label="ëŒ€í™” ë³´ê¸°">
                    ğŸ—¨ï¸
                </button>
                <button id="write-btn" class="icon-btn action-btn" aria-label="ê¸€ì“°ê¸°">
                    âœï¸
                </button>
                <button id="navigate-btn" class="navigate-btn disabled">
                    <span id="mode-indicator" class="mode-indicator">ğŸš¶</span>
                    <span class="btn-text">ê²½ë¡œ ì•ˆë‚´ ì‹œì‘</span>
                </button>
            </div>

            <!-- Context Dashboard (ì•ˆë‚´ ì¤‘ í‘œì‹œ) -->
            <div id="dashboard-container" class="dashboard-container hidden">
                <div class="dashboard-info">
                    <!-- [NEW] Line 1: Stats (Time | Distance) -->
                    <div id="dash-stats" class="dash-text stats">ëª©ì ì§€ê¹Œì§€ 0ë¶„ | 0km</div>
                    <div id="dash-primary" class="dash-text primary">ì •ë³´ ë¡œë”©ì¤‘...</div>
                    <div id="dash-secondary" class="dash-text secondary">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
                </div>

                <div class="dashboard-actions">
                    <button id="stop-nav-btn" class="icon-btn small stop" aria-label="ì•ˆë‚´ ì¢…ë£Œ">
                        <img src="pin.png" alt="ì¤‘ì§€">
                    </button>
                </div>
            </div>
        </div>

        <!-- ë©”ì‹œì§€ ì‘ì„± ëª¨ë‹¬ -->
        <div id="write-modal" class="modal hidden">
            <div class="modal-content glass-premium write-modal-content">
                <h3 id="write-modal-title">ê¸€ ë‚¨ê¸°ê¸° : ğŸ“ ìœ„ì¹˜ í™•ì¸ ì¤‘...</h3>

                <div class="write-area">
                    <div class="floating-field">
                        <svg class="field-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                        </svg>
                        <textarea id="write-input" maxlength="140" placeholder=" "></textarea>
                        <label for="write-input" class="floating-label">ì´ ì¥ì†Œì— ëŒ€í•œ ì´ì•¼ê¸°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”...</label>
                        <div class="char-count"><span id="curr-char">0</span>/140</div>
                    </div>
                </div>

                <div class="tag-input-wrapper">
                    <div class="floating-field">
                        <svg class="field-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" />
                            <line x1="7" y1="7" x2="7.01" y2="7" />
                        </svg>
                        <input type="text" id="write-tags" class="tag-input" placeholder=" " maxlength="50">
                        <label for="write-tags" class="floating-label">#íƒœê·¸ ì…ë ¥</label>
                    </div>
                </div>

                <!-- ì¶”ì²œ íƒœê·¸ ì¹© (ì„ ì œì‹œ) -->
                <div class="tag-chips-container">
                    <button class="tag-chip" data-tag="#ê²½ë¡œê¿€íŒ">#ê²½ë¡œê¿€íŒ</button>
                    <button class="tag-chip" data-tag="#ì¹œì ˆë§¤ì¥">#ì¹œì ˆë§¤ì¥</button>
                    <button class="tag-chip" data-tag="#ì£¼ì°¨ì¥ë³„_ë™ì¶œì…êµ¬">#ì£¼ì°¨ì¥ë³„_ë™ì¶œì…êµ¬</button>
                    <button class="tag-chip" data-tag="#ì–‘ë°©í–¥ì¶œì…">#ì–‘ë°©í–¥ì¶œì…</button>
                    <button class="tag-chip" data-tag="#ì§€ë„ì•ˆë‚´_í‹€ë¦¼">#ì§€ë„ì•ˆë‚´_í‹€ë¦¼</button>
                </div>

                <div class="modal-actions horizontal">
                    <button id="write-cancel-btn" class="modal-action-btn secondary">ì·¨ì†Œ</button>
                    <button id="write-save-btn" class="modal-action-btn primary">ì €ì¥</button>
                </div>
            </div>
        </div>

        <!-- ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ (ì¹´ë“œ í˜•íƒœ) -->
        <div id="message-overlay" class="message-overlay hidden">
            <!-- JSë¡œ ì¹´ë“œ ì£¼ì… -->
            <button id="close-message-btn" class="icon-btn close-floating">âœ•</button>
            <div id="message-cards-container" class="message-cards-container">
                <!-- Card Template -->
            </div>
        </div>

        <!-- ìŠ¤ë ˆë“œ ìƒì„¸ íŒ¨ë„ (ìš°ì¸¡ ìŠ¬ë¼ì´ë“œ) - 3ë‹¨ íƒ­ êµ¬ì¡° -->
        <div id="thread-panel" class="thread-panel">
            <!-- í—¤ë” -->
            <div class="thread-header">
                <button id="close-thread-btn" class="thread-back-btn">â† ë’¤ë¡œ</button>
                <span id="thread-place-name" class="thread-place">ì¥ì†Œ ì´ë¦„</span>
            </div>

            <!-- ìŠ¤í¬ë¡¤ ì˜ì—­ (íƒ­ í¬í•¨) -->
            <div class="thread-scroll-area">
                <!-- 3ë‹¨ íƒ­ -->
                <div class="thread-tabs">
                    <button class="tab-btn active" data-tab="comments">ëŒ“ê¸€</button>
                    <button class="tab-btn" data-tab="place">ì´ ì¥ì†Œ</button>
                    <button class="tab-btn" data-tab="tags">í•´ì‹œíƒœê·¸</button>
                </div>

                <!-- ì»¨í…ì¸  ì˜ì—­ (íƒ­ë³„ë¡œ ë™ì  ë Œë”ë§) -->
                <div class="thread-content" id="thread-content">
                    <!-- JSë¡œ íƒ­ ì»¨í…ì¸  ì£¼ì… -->
                </div>
            </div>

            <!-- í•˜ë‹¨ ê³ ì • ì…ë ¥ì°½ -->
            <div class="thread-input-bar hidden">
                <input type="text" id="thread-comment-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”...">
                <button id="thread-comment-submit">ë“±ë¡</button>
            </div>
        </div>

        <div id="menu-overlay" class="menu-overlay"></div>

        <!-- ì‚¬ì´ë“œ ë©”ë‰´ (ì˜¤ë²„ë ˆì´ ìœ„ì— ë°°ì¹˜í•˜ê¸° ìœ„í•´ ìˆœì„œ ë³€ê²½) -->
        <div id="side-menu" class="side-menu">
            <div class="menu-header profile-mode">
                <div class="profile-container">
                    <div class="profile-img-wrapper">
                        <img id="profile-img"
                            src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ddd'/%3E%3Ctext x='50' y='50' dy='.3em' text-anchor='middle' font-size='40'%3EğŸ‘¤%3C/text%3E%3C/svg%3E"
                            alt="Profile">
                        <button id="edit-profile-img-btn" class="edit-btn" aria-label="ì‚¬ì§„ ë³€ê²½">ğŸ“·</button>
                        <input type="file" id="profile-img-input" accept="image/*" class="hidden">
                    </div>
                    <div class="profile-info-wrapper">
                        <div class="nickname-row">
                            <input type="text" id="profile-nickname" value="" readonly>
                            <span id="profile-id-suffix" class="id-suffix"></span>
                            <button id="edit-nickname-btn" class="edit-btn" aria-label="ë³„ëª… ìˆ˜ì •">âœï¸</button>
                        </div>
                    </div>
                </div>
                <button id="close-menu-btn" class="icon-btn close-menu">âœ•</button>
            </div>
            <nav class="menu-nav">
                <!-- ë‚´ í™œë™ (ìµœìƒë‹¨, ê°•ì¡°) -->
                <button id="open-dashboard-btn" class="menu-item highlight">
                    <span>ğŸ†</span> ë‚´ í™œë™
                </button>

                <!-- ëª¨ë“œ ìŠ¤ìœ„ì¹˜ (ìº¡ìŠí˜•) -->
                <div class="menu-group">
                    <div class="menu-label">ì´ë™ ëª¨ë“œ</div>
                    <div id="mode-capsule-switch" class="mode-capsule-switch">
                        <button class="capsule-option active" data-mode="walking">
                            <span>ğŸš¶</span> ë„ë³´
                        </button>
                        <button class="capsule-option" data-mode="wheelchair">
                            <span>â™¿</span> íœ ì²´ì–´
                        </button>
                    </div>
                </div>
                <button class="menu-item" data-action="overlay-settings">
                    <span>ğŸ—ºï¸</span> ì˜¤ë²„ë ˆì´ ì„¤ì •
                </button>


            </nav>
            <div class="menu-footer">
                <p>ë°œê¸¸ë§µ v1.0.0</p>
                <p>Balgil Map</p>
            </div>
        </div>
    </div>

    <!-- í”Œë¡œíŒ… ì˜¤ë²„ë ˆì´ ëª¨ë“œ (ë°ëª¨ìš©) -->
    <div id="floating-overlay" class="floating-overlay hidden">
        <div class="overlay-header">
            <span class="destination-text">ğŸ“ â†’ <span id="overlay-destination">ëª©ì ì§€ëª…</span></span>
            <button id="close-overlay-btn" class="icon-btn small">âœ•</button>
        </div>
        <div id="overlay-map" class="overlay-map"></div>
        <div class="resize-handle"></div>
    </div>

    <!-- ì˜¤ë²„ë ˆì´ ì„¤ì • ëª¨ë‹¬ -->
    <div id="overlay-settings-modal" class="modal hidden">
        <div class="modal-content glass">
            <h3>ì˜¤ë²„ë ˆì´ ì„¤ì •</h3>
            <div class="setting-item">
                <label for="opacity-slider">íˆ¬ëª…ë„: <span id="opacity-value">30</span>%</label>
                <input type="range" id="opacity-slider" min="0" max="50" value="30">
            </div>
            <div class="modal-actions">
                <button id="close-settings-btn" class="secondary-btn">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ê²½ìœ ì§€ ì„¤ì • ëª¨ë‹¬ -->
    <div id="waypoint-modal" class="modal hidden">
        <div class="modal-content glass">
            <h3>ìœ„ì¹˜ ì˜µì…˜</h3>
            <div class="waypoint-options">
                <button class="waypoint-btn" data-action="new-dest">
                    <span class="waypoint-icon">ğŸ</span>
                    <span>ìƒˆ ëª©ì ì§€ë¡œ ì„¤ì •</span>
                </button>
                <button class="waypoint-btn" data-action="waypoint">
                    <span class="waypoint-icon">â•</span>
                    <span>ê²½ìœ ì§€ë¡œ ì¶”ê°€</span>
                </button>
                <button class="waypoint-btn" data-action="final-dest">
                    <span class="waypoint-icon">ğŸâ¡ï¸</span>
                    <span>ìµœì¢… ëª©ì ì§€ë¡œ ì¶”ê°€</span>
                </button>
                <button class="waypoint-btn cancel" data-action="cancel">
                    <span>ì·¨ì†Œ</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ë‚˜ì˜ ê¸°ë¡ ëª¨ë‹¬ -->
    <div id="my-records-modal" class="modal hidden">
        <div class="modal-content glass my-records-content">
            <h3>ğŸ† ë‚˜ì˜ í™œë™</h3>

            <div class="stats-summary" id="stats-summary">
                <div class="stat-item">
                    <span class="stat-label">ë„ë³´</span>
                    <span class="stat-value" id="stat-walking">0.0km</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">íœ ì²´ì–´</span>
                    <span class="stat-value" id="stat-wheelchair">0.0km</span>
                </div>
            </div>

            <div class="records-tabs">
                <button class="tab-btn active" data-tab="routes">ì´ë™</button>
                <button class="tab-btn" data-tab="messages">ëŒ€í™”</button>
                <button class="tab-btn" data-tab="comments">ëŒ“ê¸€</button>
            </div>
            <div class="records-body">
                <div id="records-list" class="records-list">
                    <!-- JSë¡œ ë™ì  ì±„ì›€ -->
                    <p class="empty-state">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
            <div class="modal-actions">
                <button id="close-records-btn" class="secondary-btn">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Navigation HUD (Vertical Stack Layout) -->
    <div id="navigation-hud" class="navigation-hud hidden">
        <!-- ì²« ë²ˆì§¸ í„´ (ë©”ì¸ ì¹´ë“œ) -->
        <div class="hud-card hud-card-main">
            <div class="hud-icon large" id="nav-next-turn-icon"></div>
            <div class="hud-info">
                <div class="hud-value large" id="nav-next-dist">0m</div>
                <div class="hud-road" id="nav-road-name"></div>
            </div>
        </div>
        <div class="hud-card hud-card-sub">
            <div class="hud-icon small" id="nav-second-icon"></div>
            <div class="hud-value small" id="nav-second-dist">0m</div>
        </div>
    </div>



    <!-- [NEW] ëŒ€ì‹œë³´ë“œ ëª¨ë‹¬ -->
    <div id="dashboard-modal" class="modal-overlay hidden">
        <div class="dashboard-content glass-premium">
            <div class="dashboard-header" id="dash-header">
                <button id="close-dashboard-btn" class="close-dashboard">âœ•</button>
                <!-- í”„ë¡œí•„ ì •ë³´ ë™ì  ì‚½ì… -->
            </div>
            <div class="dashboard-tabs">
                <button class="dash-tab-btn active" data-tab="movement">ğŸ¦¶ ë‚´ ë°œìêµ­</button>
                <button class="dash-tab-btn" data-tab="social">ğŸ’¬ ë‚´ ëª©ì†Œë¦¬</button>
            </div>
            <div class="dashboard-body" id="dash-content-area">
                <!-- íƒ­ ì»¨í…ì¸  ë™ì  ì‚½ì… -->
            </div>
        </div>
    </div>

    <!-- Scripts: Bottom of body for better initial rendering perception -->
    <!-- Scripts: Bottom of body for better initial rendering perception -->
    <!-- OpenLayers JS -->
    <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js" defer></script>

    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
    <script src="js/supabase-config.js?v=20260122_3" defer></script>
    <!-- App Modules: defer ensures execution order -->
    <script src="js/icons.js?v=1.2" defer></script>
    <script src="js/config.js?v=1.2" defer></script>
    <script src="js/state.js?v=1.2" defer></script>
    <script src="js/utils.js?v=20260122_3" defer></script>
    <script src="js/data_collector.js?v=1.2" defer></script>
    <script src="js/path_manager.js?v=1.2" defer></script>
    <script src="js/route_manager.js?v=1.2" defer></script>
    <script src="js/map_manager.js?v=20260123_1" defer></script>
    <script src="js/services/MessageService.js?v=20260123_1" defer></script>
    <script src="js/social_manager.js?v=20260123_1" defer></script>
    <script src="js/ui_manager.js?v=20260123_1" defer></script>
    <script src="js/dashboard_manager.js?v=1.0" defer></script>
    <script src="js/debug_overlay.js?v=1.0" defer></script>
    <!-- Kakao Maps SDK (Deferred) -->
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=94efadb747ddb4a6f534eae8dc61a99e&libraries=services" defer></script>
    <script src="js/app.js?v=20260123_1" defer></script>
</body>

</html>
