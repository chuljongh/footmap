<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°œê¸¸ë§µ DB ê´€ë¦¬ì</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, sans-serif; background: #1a1a2e; color: #eee; padding: 20px; }
        h1 { color: #00d4aa; margin-bottom: 10px; }
        h2 { color: #888; font-size: 14px; margin: 20px 0 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; font-size: 13px; }
        th, td { border: 1px solid #333; padding: 8px; text-align: left; }
        th { background: #16213e; color: #00d4aa; }
        tr:nth-child(even) { background: #0f0f23; }
        tr:hover { background: #1f4068; }
        .mode-walking { color: #4ade80; }
        .mode-wheelchair { color: #60a5fa; }
        .mode-vehicle { color: #f87171; }
        .timestamp { color: #888; font-size: 11px; }
        .points-cell { max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .summary { background: #16213e; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center; }
        .summary span { margin-right: 10px; }
        .btn { background: #00d4aa; color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn:hover { background: #00b894; }
        .btn.disabled { background: #444; color: #888; cursor: not-allowed; }
        .pagination { display: flex; gap: 10px; align-items: center; margin: 20px 0; }
        .page-info { color: #888; }
    </style>
</head>
<body>
    <h1>ğŸ¦¶ ë°œê¸¸ë§µ DB ê´€ë¦¬ì</h1>

    <div class="summary">
        <span>ğŸ“Š ì´ ê²½ë¡œ: <strong>{{ total_routes }}</strong>ê°œ</span>
        <span>ğŸ‘¤ ì´ ì‚¬ìš©ì: <strong>{{ total_users }}</strong>ëª…</span>
        <span>ğŸ“ ì´ ë©”ì‹œì§€: <strong>{{ total_messages }}</strong>ê°œ</span>
        <a class="btn" href="?key={{ key }}&page={{ page }}">ğŸ”„ ìƒˆë¡œê³ ì¹¨</a>
    </div>

    <h2>ğŸ“ ê²½ë¡œ ë°ì´í„° (Routes) - í˜ì´ì§€ {{ page }} / {{ total_pages }}</h2>

    <div class="pagination">
        {% if page > 1 %}
        <a class="btn" href="?key={{ key }}&page={{ page - 1 }}">â—€ ì´ì „</a>
        {% else %}
        <span class="btn disabled">â—€ ì´ì „</span>
        {% endif %}

        <span class="page-info">{{ page }} / {{ total_pages }} (ì´ {{ total_routes }}ê±´)</span>

        {% if page < total_pages %}
        <a class="btn" href="?key={{ key }}&page={{ page + 1 }}">ë‹¤ìŒ â–¶</a>
        {% else %}
        <span class="btn disabled">ë‹¤ìŒ â–¶</span>
        {% endif %}
    </div>

    <table>
        <tr>
            <th>ID</th>
            <th>User</th>
            <th>Mode</th>
            <th>Distance</th>
            <th>Duration</th>
            <th>Points</th>
            <th>Timestamp</th>
        </tr>
        {% for route in routes %}
        <tr>
            <td>{{ route.id }}</td>
            <td>{{ route.user_id or 'ìµëª…' }}</td>
            <td class="mode-{{ route.mode }}">{{ route.mode }}</td>
            <td>{{ "%.2f"|format(route.distance or 0) }} km</td>
            <td>{{ "%.0f"|format(route.duration or 0) }}s</td>
            <td class="points-cell" title="{{ route.points }}">{{ (route.points|length) if route.points else 0 }} chars</td>
            <td class="timestamp">{{ route.timestamp }}</td>
        </tr>
        {% endfor %}
    </table>

    <h2>ğŸ‘¤ ì‚¬ìš©ì ëª©ë¡ (Users) - ìµœì‹  20ëª…</h2>
    <table>
        <tr>
            <th>ID (ë‹‰ë„¤ì„)</th>
            <th>Points</th>
            <th>Total Dist</th>
            <th>Walking</th>
            <th>Wheelchair</th>
            <th>Created</th>
        </tr>
        {% for user in users %}
        <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.points }}</td>
            <td>{{ "%.2f"|format(user.total_distance or 0) }} km</td>
            <td>{{ "%.2f"|format(user.dist_walking or 0) }} km</td>
            <td>{{ "%.2f"|format(user.dist_wheelchair or 0) }} km</td>
            <td class="timestamp">{{ user.created_at }}</td>
        </tr>
        {% endfor %}
    </table>

    <h2>ğŸ’¬ ìµœê·¼ ë©”ì‹œì§€ (Messages) - ìµœì‹  30ê°œ</h2>
    <table>
        <tr>
            <th>ID</th>
            <th>User</th>
            <th>Content</th>
            <th>Coords</th>
            <th>Votes</th>
            <th>Created</th>
        </tr>
        {% for msg in messages %}
        <tr>
            <td>{{ msg.id }}</td>
            <td>{{ msg.user_id or 'ìµëª…' }}</td>
            <td>{{ msg.content[:50] }}{% if msg.content|length > 50 %}...{% endif %}</td>
            <td>{{ "%.4f"|format(msg.lat or 0) }}, {{ "%.4f"|format(msg.lng or 0) }}</td>
            <td>ğŸ‘{{ msg.upvotes or 0 }} ğŸ‘{{ msg.downvotes or 0 }}</td>
            <td class="timestamp">{{ msg.created_at }}</td>
        </tr>
        {% endfor %}
    </table>
</body>
</html>

