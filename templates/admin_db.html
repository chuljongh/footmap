<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°œê¸¸ë§µ DB ê´€ë¦¬ì</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, sans-serif; background: #1a1a2e; color: #eee; padding: 20px; }
        h1 { color: #00d4aa; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        h2 { color: #888; font-size: 14px; margin: 20px 0 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; font-size: 13px; }
        th, td { border: 1px solid #333; padding: 8px; text-align: left; }
        th { background: #16213e; color: #00d4aa; }
        tr:nth-child(even) { background: #0f0f23; }
        tr:hover { background: #1f4068; }
        .mode-walking, .mode-pedestrian { color: #4ade80; }
        .mode-wheelchair { color: #60a5fa; }
        .mode-vehicle { color: #f87171; }
        .timestamp { color: #888; font-size: 11px; }
        .points-cell { max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .nav-tabs a { text-decoration: none; color: #888; padding: 8px 16px; border-radius: 4px; transition: all 0.2s; }
        .nav-tabs a:hover { background: #1f4068; color: #eee; }
        .nav-tabs a.active { background: #00d4aa; color: #000; font-weight: bold; }
        .summary { background: #16213e; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center; font-size: 13px; }
        .summary span { margin-right: 10px; }
        .btn { background: #00d4aa; color: #000; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; font-size: 13px; }
        .btn:hover { background: #00b894; }
        .btn.disabled { background: #444; color: #888; cursor: not-allowed; }
        .pagination { display: flex; gap: 10px; align-items: center; margin: 20px 0; justify-content: center; }
        .page-info { color: #888; font-size: 14px; }
        .empty-state { text-align: center; color: #666; padding: 50px 0; }
    </style>
</head>
<body>
    <h1>
        <span>ğŸ¦¶ ë°œê¸¸ë§µ DB ê´€ë¦¬ì</span>
        <a class="btn" href="?key={{ key }}&section={{ section }}&page={{ page }}">ğŸ”„ ìƒˆë¡œê³ ì¹¨</a>
    </h1>

    <div class="summary">
        <span>ğŸ“Š ê²½ë¡œ: <strong>{{ total_routes }}</strong></span>
        <span>ğŸ‘¤ ì‚¬ìš©ì: <strong>{{ total_users }}</strong></span>
        <span>ğŸ“ ë©”ì‹œì§€: <strong>{{ total_messages }}</strong></span>
    </div>

    <div class="nav-tabs">
        <a href="?key={{ key }}&section=routes" class="{{ 'active' if section == 'routes' else '' }}">ğŸ“ ê²½ë¡œ (Routes)</a>
        <a href="?key={{ key }}&section=users" class="{{ 'active' if section == 'users' else '' }}">ğŸ‘¤ ì‚¬ìš©ì (Users)</a>
        <a href="?key={{ key }}&section=messages" class="{{ 'active' if section == 'messages' else '' }}">ğŸ’¬ ë©”ì‹œì§€ (Messages)</a>
    </div>

    <!-- ROUTES SECTION -->
    {% if section == 'routes' %}
    <h2>ğŸ“ ê²½ë¡œ ë°ì´í„° (í˜ì´ì§€ {{ page }} / {{ total_pages }})</h2>
    <table>
        <tr>
            <th>ID</th>
            <th>User</th>
            <th>Mode</th>
            <th>Start â†’ End</th>
            <th>Distance</th>
            <th>Duration</th>
            <th>Points</th>
            <th>Approach</th>
            <th>Timestamp (KST)</th>
        </tr>
        {% for route in routes %}
        <tr>
            <td>{{ route.id }}</td>
            <td>{{ route.user_id or 'ìµëª…' }}</td>
            <td class="mode-{{ route.mode or 'walking' }}">{{ route.mode or '-' }}</td>
            <td style="font-size:11px;">
                {% if route.start_coords %}{{ route.start_coords[:20] }}...{% else %}-{% endif %}
                â†’
                {% if route.end_coords %}{{ route.end_coords[:20] }}...{% else %}-{% endif %}
            </td>
            <td>{{ "%.2f"|format(route.distance or 0) }} km</td>
            <td>{{ "%.0f"|format(route.duration or 0) }}s</td>
            <td class="points-cell">{{ (route.points_json|length) if route.points_json else 0 }} chars</td>
            <td style="color:#00d4aa;">
                {% set ap = route.approach_path|default('', true) %}
                {% if ap and ap|length > 2 %}
                ğŸ¦¶ {{ ap|length }} chars
                {% else %}
                -
                {% endif %}
            </td>
            <td class="timestamp">{{ route.timestamp_kst }}</td>
        </tr>
        {% else %}
        <tr><td colspan="9" class="empty-state">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
        {% endfor %}
    </table>
    {% endif %}

    <!-- USERS SECTION -->
    {% if section == 'users' %}
    <h2>ğŸ‘¤ ì‚¬ìš©ì ëª©ë¡ (í˜ì´ì§€ {{ page }} / {{ total_pages }})</h2>
    <table>
        <tr>
            <th>ID (ë‹‰ë„¤ì„)</th>
            <th>Points</th>
            <th>Total Dist</th>
            <th>Walking</th>
            <th>Wheelchair</th>
            <th>Created (KST)</th>
        </tr>
        {% for user in users %}
        <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.points or 0 }}</td>
            <td>{{ "%.2f"|format(user.total_distance or 0) }} km</td>
            <td>{{ "%.2f"|format(user.dist_walking or 0) }} km</td>
            <td>{{ "%.2f"|format(user.dist_wheelchair or 0) }} km</td>
            <td class="timestamp">{{ user.created_at_kst }}</td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="empty-state">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
        {% endfor %}
    </table>
    {% endif %}

    <!-- MESSAGES SECTION -->
    {% if section == 'messages' %}
    <h2>ğŸ’¬ ë©”ì‹œì§€ ëª©ë¡ (í˜ì´ì§€ {{ page }} / {{ total_pages }})</h2>
    <table>
        <tr>
            <th>ID</th>
            <th>User</th>
            <th>Text</th>
            <th>Coords</th>
            <th>Votes</th>
            <th>Timestamp (KST)</th>
        </tr>
        {% for msg in messages %}
        <tr>
            <td>{{ msg.id }}</td>
            <td>{{ msg.user_id or 'ìµëª…' }}</td>
            <td>{{ (msg.text or '')[:50] }}{% if msg.text and msg.text|length > 50 %}...{% endif %}</td>
            <td>{{ "%.4f"|format(msg.coord_y or 0) }}, {{ "%.4f"|format(msg.coord_x or 0) }}</td>
            <td>ğŸ‘{{ msg.likes or 0 }} ğŸ‘{{ msg.dislikes or 0 }}</td>
            <td class="timestamp">{{ msg.timestamp_kst }}</td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="empty-state">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
        {% endfor %}
    </table>
    {% endif %}

    <!-- Common Pagination -->
    <div class="pagination">
        {% if page > 1 %}
        <a class="btn" href="?key={{ key }}&section={{ section }}&page={{ page - 1 }}">â—€ ì´ì „</a>
        {% else %}
        <span class="btn disabled">â—€ ì´ì „</span>
        {% endif %}

        <span class="page-info">{{ page }} / {{ total_pages }}</span>

        {% if page < total_pages %}
        <a class="btn" href="?key={{ key }}&section={{ section }}&page={{ page + 1 }}">ë‹¤ìŒ â–¶</a>
        {% else %}
        <span class="btn disabled">ë‹¤ìŒ â–¶</span>
        {% endif %}
    </div>

</body>
</html>
